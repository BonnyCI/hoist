---
- name: Common task for all nodes
  hosts: nodepool.portbleu.com,zuul.portbleu.com,merger01.portbleu.com
  become: yes
  tags: ['common']
  roles:
    - role: common
    - role: dd-agent

- name: Install mysql
  hosts: zuul.portbleu.com
  become: yes
  tags: ['mysql']
  roles:
    - role: mysql
    - role: dd-mysql
      tags:
        - monitoring
    - role: databases

- name: Install zuul
  hosts: zuul.portbleu.com
  become: yes
  tags: ['zuul']
  roles:
    - role: gearman
    - role: dd-gearman
    - role: zuul
      zuul_gearman_server_start: false

- name: Install nodepool
  hosts: nodepool.portbleu.com
  become: yes
  tags: ['nodepool']
  roles:
    - role: nodepool
