dependencies:
  - role: nginx
    nginx_sites:
      - name: letsencrypt
        state: present
        document_root: /etc/letsencrypt/webroot
        port: 80
        content: |
          location /.well-known/acme-challenge {
            allow all;
            root {{ letsencrypt_webroot }}/.well-known/acme-challenge;
          }

          {% if letsencrypt_configure_redirect %}
          location / {
              return 301 https://$host$request_uri;
          }
          {% endif %}

  - role: letsencrypt
    letsencrypt_webroot: /etc/letsencrypt/webroot
    letsencrypt_reload_handler: Reload nginx
